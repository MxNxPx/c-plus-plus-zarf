# Copyright 2024 Defense Unicorns
# SPDX-License-Identifier: AGPL-3.0-or-later OR LicenseRef-Defense-Unicorns-Commercial

# yaml-language-server: $schema=https://raw.githubusercontent.com/defenseunicorns/zarf/main/zarf.schema.json
kind: ZarfPackageConfig
metadata:
  name: c-plus-plus
  description: "UDS C++ Example"
  version: "###ZARF_PKG_TMPL_VERSION###"

constants:
  - name: VERSION
    value: "###ZARF_PKG_TMPL_VERSION###"
  - name: PLATFORM
    value: "###ZARF_PKG_TMPL_PLATFORM###"
variables:
  - name: IMAGE_TAG
    default: "###ZARF_PKG_TMPL_VERSION###"

components:
  - name: c-plus-plus
    required: true
    only:
      flavor: upstream
    charts:
      - name: uds-c-plus-plus
        namespace: c-plus-plus
        version: 0.1.0
        localPath: ./chart
        valuesFiles:
          - values/common-values.yaml
    actions:
      onCreate:
        before:
          - cmd: docker build -t c-plus-plus-api:###ZARF_PKG_TMPL_VERSION### --platform "###ZARF_PKG_TMPL_PLATFORM###" .
            dir: src/c-plus-plus-api/
          - cmd: docker save c-plus-plus-api:###ZARF_PKG_TMPL_VERSION### -o c-plus-plus.tar
    imageArchives:
      - path: c-plus-plus.tar
        images:
          - c-plus-plus-api:###ZARF_PKG_TMPL_VERSION###
